// Generated by CoffeeScript 1.3.3
(function() {
  var $, AROMA_CSS, Aroma, LOADING_1, LOADING_2, StaticSource, StreamingSource, add_class_name, debugging, encode_byte_array, get, get_image_data, insert_css, listen, log, remove_class_name,
    __slice = [].slice;

  $ = function(id) {
    if (typeof id === "string") {
      return document.getElementById(id);
    } else {
      return id;
    }
  };

  debugging = false;

  log = function() {
    if (debugging) {
      return console.log.apply(console, arguments);
    }
  };

  listen = function(elm, name, fn) {
    return elm.addEventListener(name, fn, true);
  };

  add_class_name = function(elm, cls) {
    if (!elm.className.match(new RegExp("\\b" + cls + "\\b"))) {
      return elm.className += " " + cls;
    }
  };

  remove_class_name = function(elm, cls) {
    return elm.className = elm.className.replace(new RegExp("\\s*\\b" + cls + "\\b", "g"), "");
  };

  Function.prototype.once = function() {
    var called, fn;
    fn = this;
    called = false;
    return function() {
      if (called) {
        return;
      }
      called = true;
      return fn.apply(this, arguments);
    };
  };

  insert_css = function() {
    var style;
    style = document.createElement("style");
    style.type = "text/css";
    style.appendChild(document.createTextNode(AROMA_CSS));
    return document.head.appendChild(style);
  };

  insert_css = insert_css.once();

  get = function(url, on_finish, on_fail, send) {
    var req;
    if (send == null) {
      send = true;
    }
    req = new XMLHttpRequest();
    req.onreadystatechange = function() {
      if (req.readyState === 4) {
        if (req.status === 200) {
          return on_finish(req);
        } else {
          return on_fail(req);
        }
      }
    };
    req.open("GET", url, true);
    if (send) {
      return req.send(null);
    } else {
      return req;
    }
  };

  encode_byte_array = function(bytes, size) {
    var char_encode, chunk_size, count, parts, pi, slice, strings;
    if (size == null) {
      size = null;
    }
    count = size || bytes.length;
    chunk_size = 1024;
    parts = Math.floor(count / chunk_size) + 1;
    strings = new Array(parts);
    slice = Function.prototype.call.bind(Array.prototype.slice);
    char_encode = Function.prototype.apply.bind(String.fromCharCode, null);
    pi = 0;
    while (pi < parts) {
      strings[pi] = char_encode(slice(bytes, pi * chunk_size, (pi + 1) * chunk_size));
      pi++;
    }
    return strings.join("");
  };

  get_image_data = function(url, callback) {
    var img;
    img = new Image();
    img.src = url;
    img.onload = function() {
      var canvas, ctx, image_data;
      canvas = document.createElement("canvas");
      log(">> loaded image " + url + " [" + img.width + ", " + img.height + "]");
      canvas.width = img.width;
      canvas.height = img.height;
      ctx = canvas.getContext("2d");
      ctx.drawImage(img, 0, 0);
      image_data = ctx.getImageData(0, 0, img.width, img.height);
      return callback(encode_byte_array(image_data.data), img.width, img.height);
    };
    img.onerror = function() {
      return callback(null);
    };
    return null;
  };

  window.get_image_data = get_image_data;

  window.encode_byte_array = encode_byte_array;

  Aroma = (function() {

    Aroma.prototype.nmf_path = "aroma.nmf";

    Aroma.prototype.async_handlers = {
      prefetch: function(msg, callback) {
        var count, file, files, loader_type, tuple, _, _i, _len, _results,
          _this = this;
        _ = msg[0], files = msg[1];
        count = files.length;
        msg = "Prefetching " + count + " file";
        if (count !== 1) {
          msg += "s";
        }
        this.show_loading(msg);
        _results = [];
        for (_i = 0, _len = files.length; _i < _len; _i++) {
          tuple = files[_i];
          loader_type = tuple[0], file = tuple[1];
          _results.push((function(file) {
            return _this.file_loader.get_file(file, loader_type, function(res) {
              if (!callback) {
                return;
              }
              if (res !== null) {
                count--;
                if (count === 0) {
                  return callback(["success"]);
                }
              } else {
                callback(["error", "Failed to get file " + file]);
                return callback = null;
              }
            });
          })(file));
        }
        return _results;
      },
      require: function(msg, callback) {
        var module, _;
        _ = msg[0], module = msg[1];
        this.show_loading("Loading module `" + module + "`");
        return this.file_loader.get_module(module, function(code, error) {
          if (code != null) {
            return callback(["success", code]);
          } else {
            return callback(["error", "Failed to find module: tried " + error]);
          }
        });
      },
      image: function(msg, callback) {
        var path, _;
        _ = msg[0], path = msg[1];
        this.show_loading("Loading `" + path + "`");
        return this.file_loader.get_file(path, "image", function(img) {
          var h, w, _ref;
          if (img != null) {
            _ref = img, img = _ref[0], w = _ref[1], h = _ref[2];
            return callback(["success", img, w, h]);
          } else {
            return ["error", "Failed to find image: " + path];
          }
        });
      },
      audio: function(msg, callback) {
        var file_type, path, type, _;
        _ = msg[0], path = msg[1], type = msg[2];
        this.show_loading("Loading `" + path + "`");
        file_type = (function() {
          switch (type) {
            case "static":
              return "sound";
            case "streaming":
              return "music";
            case "stream":
              return "music";
            default:
              throw "Unknown source type: " + type;
          }
        })();
        return this.file_loader.get_file(path, file_type, function(source_id) {
          if (source_id !== null) {
            return callback(["success", source_id]);
          } else {
            return callback(["error", "Failed to find audio: " + path]);
          }
        });
      },
      font: function(msg, callback) {
        var alphabet, font, font_name, letter, _;
        _ = msg[0], font_name = msg[1], alphabet = msg[2];
        font = new Aroma.Font(font_name);
        return callback((function() {
          var _i, _len, _ref, _results;
          _ref = alphabet.split("");
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            letter = _ref[_i];
            _results.push(font.render_glyph(letter));
          }
          return _results;
        })());
      }
    };

    Aroma.prototype.message_handlers = {
      std_out: function(msg) {
        return this.fire("std_out", msg[1]);
      },
      std_err: function(msg) {
        return this.fire("std_err", msg[1]);
      },
      request: function(msg) {
        var data, id, _,
          _this = this;
        _ = msg[0], id = msg[1], data = msg[2];
        return this.dispatch(this.async_handlers, data[0], data, function(res) {
          _this.hide_loading();
          return _this.post_message(["response", id, res]);
        });
      },
      audio: function(msg) {
        var fn, s, source_id, _;
        _ = msg[0], source_id = msg[1], fn = msg[2];
        s = this.audio.get_source(source_id);
        if (s[fn]) {
          return s[fn].apply(s, msg.slice(3));
        }
      },
      track_event: function(msg) {
        var event, _;
        _ = msg[0], event = msg[1];
        log(event);
        return this.track_event.apply(this, event);
      }
    };

    function Aroma(container, width, height, events) {
      var _this = this;
      this.container = container;
      this.width = width;
      this.height = height;
      this.events = events != null ? events : {};
      this.container = $(this.container);
      this.module = null;
      this.file_loader = new Aroma.FileLoader(this);
      this.audio = new Aroma.Audio;
      this.listener = this.create_dom();
      this.container.appendChild(this.listener);
      this.loading_elm = this.listener.querySelector(".loading_message");
      this.events.std_out = this.events.std_out || function(msg) {
        return console.log(msg);
      };
      this.events.std_err = this.events.std_err || function(msg) {
        return console.error(msg);
      };
      insert_css();
      this.events.loaded = this.events.loaded || function() {
        return _this.execute("require \"main\"\nif aroma and aroma.load then\n  aroma.load()\nend");
      };
      listen(this.listener, "load", function() {
        log("Loaded module");
        _this.module = _this.listener.querySelector("embed");
        add_class_name(_this.module, "loaded");
        return _this.fire("loaded");
      });
      listen(this.listener, "message", function(e) {
        return _this.handle_message(e);
      });
    }

    Aroma.prototype.create_dom = function() {
      var listener;
      listener = document.createElement("div");
      listener.className = "aroma_listener";
      listener.innerHTML = "<div class=\"loading_message\">Loading something..</div>\n<embed name=\"nacl_module\"\n  id=\"aroma\"\n  width=\"" + this.width + "\" height=\"" + this.height + "\"\n  src=\"" + this.nmf_path + "\"\n  type=\"application/x-nacl\">\n  </embed>";
      return listener;
    };

    Aroma.prototype.show_loading = function(msg) {
      if (msg == null) {
        msg = "Loading";
      }
      if (!this.loading_elm) {
        return;
      }
      this.loading_elm.innerHTML = msg;
      if (!this.loading_elm.className.match(/visible/)) {
        return this.loading_elm.className += " visible";
      }
    };

    Aroma.prototype.hide_loading = function() {
      if (!this.loading_elm) {
        return;
      }
      return this.loading_elm.className = this.loading_elm.className.replace(/visible/g, "");
    };

    Aroma.prototype.reset = function() {
      return this.audio.stop_all();
    };

    Aroma.prototype.fire = function() {
      var args, name;
      name = arguments[0], args = 2 <= arguments.length ? __slice.call(arguments, 1) : [];
      if (this.events[name]) {
        return this.events[name].apply(null, args);
      }
    };

    Aroma.prototype.execute = function(lua) {
      this.reset();
      return this.post_message(['execute', lua]);
    };

    Aroma.prototype.post_message = function(o) {
      return this.module.postMessage(JSON.stringify(o));
    };

    Aroma.prototype.dispatch = function() {
      var args, handler, handlers, key;
      handlers = arguments[0], key = arguments[1], args = 3 <= arguments.length ? __slice.call(arguments, 2) : [];
      handler = handlers[key];
      if (handler) {
        return handler.apply(this, args);
      } else {
        throw Error("missing handler for `" + key + "`");
      }
    };

    Aroma.prototype.handle_message = function(msg) {
      var o;
      log(">> " + msg.data + " :: " + (typeof msg.data));
      o = (function() {
        try {
          return JSON.parse(msg.data);
        } catch (_error) {}
      })();
      if (o) {
        return this.dispatch(this.message_handlers, o[0], o);
      }
    };

    Aroma.prototype.track_event = function(category, action, label, value, interactive) {
      if (label == null) {
        label = null;
      }
      if (value == null) {
        value = null;
      }
      if (interactive == null) {
        interactive = true;
      }
      try {
        return _gaq.push(['_trackEvent', category, action, label, value, !interactive]);
      } catch (_error) {}
    };

    return Aroma;

  })();

  StreamingSource = (function() {

    StreamingSource.from_url = function(url, callback) {
      var elm, source,
        _this = this;
      elm = document.createElement("audio");
      elm.src = url;
      elm.autoplay = false;
      source = new StreamingSource(elm);
      listen(elm, "loadedmetadata", function() {
        return callback(source);
      });
      listen(elm, "error", function() {
        return callback(null);
      });
      return listen(elm, "ended", function() {
        if (source.looping) {
          source.rewind();
          return source.play();
        }
      });
    };

    function StreamingSource(audio_elm) {
      this.audio_elm = audio_elm;
    }

    StreamingSource.prototype.play = function() {
      return this.audio_elm.play();
    };

    StreamingSource.prototype.pause = function() {
      return this.audio_elm.pause();
    };

    StreamingSource.prototype.set_looping = function(looping) {
      this.looping = looping;
    };

    StreamingSource.prototype.stop = function() {
      this.pause();
      return this.rewind();
    };

    StreamingSource.prototype.rewind = function() {
      return this.audio_elm.currentTime = 0;
    };

    return StreamingSource;

  })();

  StaticSource = (function() {

    StaticSource.from_url = function(context, url, callback) {
      var fail, pass, req,
        _this = this;
      pass = function(req) {
        return context.decodeAudioData(req.response, function(buffer) {
          return callback(new StaticSource(context, buffer));
        });
      };
      fail = function(req) {
        return callback(null);
      };
      req = get(url, pass, fail, false);
      req.responseType = "arraybuffer";
      return req.send();
    };

    function StaticSource(context, buffer) {
      this.context = context;
      this.buffer = buffer;
    }

    StaticSource.prototype.play = function() {
      var source;
      source = this.context.createBufferSource();
      source.buffer = this.buffer;
      source.connect(this.context.destination);
      return source.noteOn(0);
    };

    return StaticSource;

  })();

  Aroma.Audio = (function() {

    function Audio() {
      this.sources = [];
      this.context = new webkitAudioContext;
    }

    Audio.prototype.stop_all = function() {
      var s, _i, _len, _ref, _results;
      _ref = this.sources;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        s = _ref[_i];
        if (s.stop) {
          _results.push(s.stop());
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    };

    Audio.prototype.get_source = function(id) {
      var s;
      s = this.sources[id];
      if (s === void 0) {
        throw "Invalid source id " + id;
      }
      return s;
    };

    Audio.prototype.add_source = function(source, url) {
      var id;
      if (!source) {
        return null;
      }
      id = this.sources.length;
      this.sources.push(source);
      return id;
    };

    return Audio;

  })();

  Aroma.Font = (function() {

    function Font(font_string) {
      this.font_string = font_string != null ? font_string : "16pt sans-serif";
      this.canvas = document.createElement("canvas");
      this.ctx = this.canvas.getContext("2d");
      this.height = this.calc_height();
    }

    Font.prototype.reset_canvas = function(w, h) {
      this.canvas.width = w;
      this.canvas.height = h;
      this.ctx.font = this.font_string;
      this.ctx.fillStyle = "white";
      return this.ctx.textBaseline = "top";
    };

    Font.prototype.calc_height = function() {
      var e, height;
      e = document.createElement("div");
      e.innerHTML = "Mg";
      e.style.font = this.font_string;
      document.body.appendChild(e);
      height = e.offsetHeight;
      document.body.removeChild(e);
      return height;
    };

    Font.prototype.render_glyph = function(str) {
      var bytestring, default_width, real_width;
      default_width = 80;
      this.reset_canvas(default_width, this.height);
      real_width = this.ctx.measureText(str).width;
      if (real_width > default_width) {
        this.reset_canvas(real_width, this.height);
      }
      this.ctx.fillText(str, 0, 0);
      bytestring = encode_byte_array(this.ctx.getImageData(0, 0, real_width, this.height).data);
      return [str, bytestring, real_width, this.height];
    };

    return Font;

  })();

  Aroma.FileLoader = (function() {

    FileLoader.prototype.loaders = {
      sound: function(path, callback) {
        var audio,
          _this = this;
        audio = this.aroma.audio;
        return StaticSource.from_url(audio.context, path, function(source) {
          return callback(audio.add_source(source));
        });
      },
      music: function(path, callback) {
        var load_it,
          _this = this;
        load_it = function() {
          if (_this.pending > 5) {
            return setTimeout(load_it, 60);
          }
          return StreamingSource.from_url(path, function(source) {
            return callback(_this.aroma.audio.add_source(source));
          });
        };
        return load_it();
      },
      image: function(path, callback) {
        return get_image_data(path, function(image_bytes, width, height) {
          if (image_bytes != null) {
            return callback([image_bytes, width, height]);
          }
          return callback(null);
        });
      }
    };

    FileLoader.prototype.default_loader = function(path, callback) {
      return this._get(path, function(req) {
        return callback(req.responseText);
      });
    };

    FileLoader.prototype._get = function(url, callback) {
      var _this = this;
      log(">> getting: " + url);
      return get(url, callback, function() {
        return typeof _this.fail_fn === "function" ? _this.fail_fn(url) : void 0;
      });
    };

    FileLoader.prototype.real_path = function(path) {
      if (this.root != null) {
        return "" + this.root + "/" + path;
      } else {
        return path;
      }
    };

    function FileLoader(aroma, root) {
      this.aroma = aroma;
      this.root = root;
      this.pending = 0;
      this.file_cache = {};
    }

    FileLoader.prototype.get_module = function(module_name, callback) {
      var path;
      path = module_name.replace(/\./g, '/');
      path = "" + path + ".lua";
      return this.get_file(path, null, callback);
    };

    FileLoader.prototype.get_file = function(path, loader, callback) {
      var _this = this;
      path = this.real_path(path);
      if (this.file_cache[path] != null) {
        return callback(this.file_cache[path]);
      }
      if (loader) {
        loader = this.loaders[loader];
      }
      if (!loader) {
        loader = this.default_loader;
      }
      this.fail_fn = function(url) {
        return callback(null, url);
      };
      this.pending++;
      return loader.call(this, path, function(result) {
        _this.pending--;
        _this.file_cache[path] = result;
        return callback(result);
      });
    };

    return FileLoader;

  })();

  window.Aroma = Aroma;

  LOADING_2 = "data:image/gif;base64,R0lGODlhEAALAPQAAAAAAP///yQkJC4uLhQUFPj4+P///9DQ0Hx8fJ6enkRERNzc3LS0tHR0dJqamkBAQNjY2Pr6+rCwsBgYGCYmJgoKCsbGxiIiIgwMDEhISF5eXjQ0NBAQEAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCwAAACwAAAAAEAALAAAFLSAgjmRpnqSgCuLKAq5AEIM4zDVw03ve27ifDgfkEYe04kDIDC5zrtYKRa2WQgAh+QQJCwAAACwAAAAAEAALAAAFJGBhGAVgnqhpHIeRvsDawqns0qeN5+y967tYLyicBYE7EYkYAgAh+QQJCwAAACwAAAAAEAALAAAFNiAgjothLOOIJAkiGgxjpGKiKMkbz7SN6zIawJcDwIK9W/HISxGBzdHTuBNOmcJVCyoUlk7CEAAh+QQJCwAAACwAAAAAEAALAAAFNSAgjqQIRRFUAo3jNGIkSdHqPI8Tz3V55zuaDacDyIQ+YrBH+hWPzJFzOQQaeavWi7oqnVIhACH5BAkLAAAALAAAAAAQAAsAAAUyICCOZGme1rJY5kRRk7hI0mJSVUXJtF3iOl7tltsBZsNfUegjAY3I5sgFY55KqdX1GgIAIfkECQsAAAAsAAAAABAACwAABTcgII5kaZ4kcV2EqLJipmnZhWGXaOOitm2aXQ4g7P2Ct2ER4AMul00kj5g0Al8tADY2y6C+4FIIACH5BAkLAAAALAAAAAAQAAsAAAUvICCOZGme5ERRk6iy7qpyHCVStA3gNa/7txxwlwv2isSacYUc+l4tADQGQ1mvpBAAIfkECQsAAAAsAAAAABAACwAABS8gII5kaZ7kRFGTqLLuqnIcJVK0DeA1r/u3HHCXC/aKxJpxhRz6Xi0ANAZDWa+kEAA7AAAAAAAAAAAA";

  LOADING_1 = "data:image/gif;base64,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";

  AROMA_CSS = "embed {\n  background: black url(" + LOADING_1 + ") 50% 50% no-repeat;\n}\n\nembed.loaded {\n  background: black;\n}\n\n.loading_message {\n  position: absolute;\n  font-size: 12px;\n  background: rgba(0,0,0, 0.5) url(" + LOADING_2 + ") 8px 50% no-repeat;\n  color: white;\n  padding: 8px 12px;\n  padding-left: 30px;\n  border-radius: 0px 0px 4px 0px;\n  box-shadow: 1px 1px 0px rgba(255,255,255, 0.4),\n    1px 1px 8px rgba(0,0,0, 0.8);\n}\n\n.loading_message:not(.visible) {\n  display: none;\n}";

}).call(this);
